---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';

import Layout from '@/layouts/Layout.astro';
import PageTitle from '@/components/PageTitle.astro';
import Card from '@/components/Card.astro';
import TableOfContent from '@/components/TableOfContent.astro';

export const getStaticPaths = (async () => {
	const blogEntries = await getCollection('js-proxy');

	return blogEntries.map((entry) => ({
		params: {
			slug: entry.slug,
		},

		props: { entry },
	}));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
const meta = {
	title: entry.data.title,
	description: entry.data.description,
};

const [nextChapter] = await getCollection('js-proxy', ({ data }) => {
	return data.chapterNumber === entry.data.chapterNumber + 1;
});
---

<Layout meta={meta}>
	<TableOfContent headings={headings} />
	<article class="brand-prose">
		<PageTitle>{entry.data.title}</PageTitle>
		<Content />
	</article>

	{
		nextChapter && (
			<Card
				title={`Chapter ${nextChapter.data.chapterNumber}: ${nextChapter.data.title}`}
				href={`/courses/js-proxy/${nextChapter.slug}`}
			>
				{nextChapter.data.description}
			</Card>
		)
	}
</Layout>
